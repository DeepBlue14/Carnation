// Generated by CoffeeScript 1.9.3
(function() {
  var Image, PNG, fs;

  fs = require('fs');

  PNG = require('pngjs').PNG;

  Image = (function() {
    Image.header = 'null';

    Image.height = 66;

    Image.done = false;

    function Image(filename) {
      this.header = filename;
      fs.createReadStream(filename).pipe(new PNG({
        filterType: 4
      })).on('parsed', function() {
        var idx, x, y;
        y = 0;
        console.log('@height ' + this.height);
        while (y < this.height) {
          x = 0;
          while (x < this.width) {
            idx = this.width * y + x << 2;
            this.data[idx] = 255 - this.data[idx];
            this.data[idx + 1] = 255 - this.data[idx + 1];
            this.data[idx + 2] = 255 - this.data[idx + 2];
            this.data[idx + 3] = this.data[idx + 3] >> 1;
            x++;
          }
          y++;
        }
        return this.pack().pipe(fs.createWriteStream('out.png'));
      }).on('end', function() {
        console.log('done');
        this.done = true;
      });
    }

    return Image;

  })();

  if (typeof module !== "undefined" && module.exports) {
    exports.Image = Image;
  } else {
    window.Image = Image;
  }

}).call(this);

//# sourceMappingURL=ImageAsync.js.map
