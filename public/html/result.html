<!DOCTYPE html>

<!--
!
! File:   result.html
! Author: James Kuczynski
! File Description: Display the selected path and instructions.
!
!
! Last Modified: 11/17/2018
!
-->

<html lang="en">
    <head>
        <title>Carnation</title>
        <link rel="shortcut icon" href="../res/image/letter.jpg"/>
        <meta charset="UTF-8">
        <!-- <meta name="viewport" content="width=device-width, initial-scale=1"> -->

        <!-- Include the Bootstrap stylesheet -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
        <link rel="stylesheet" href="../css/index.css">

    </head>
    <body> <!-- style="background:url('res/image/space1.jpg')" -->
        <div class="container">
            <div id="boardDiv" class="row">
                <div class="col-sm-4">

                    <h3>Result</h3>

                    <img id="img1" src="../res/arc/UMassLowell/North/OlsenHall/olsen_hall_floor3.png" alt="path" style="display: none;">
                    <canvas id="myCanvas" width="2000" height="1000" style="border:0px solid #d3d3d3;">Your browser does not support the HTML5 canvas tag.</canvas>
                    <img src="../test/my_path.png" alt="path" style="display: none;">
                    <img src="../test/my_path.png" alt="path" style="display: none;">
                    <img src="../test/my_path.png" alt="path" style="display: none;">
                    <img src="../test/my_path.png" alt="path" style="display: none;">

                </div>
                <script>
                    window.onload = async function() {
                        var c=document.getElementById("myCanvas");
                        var ctx=c.getContext("2d");
                        var img=document.getElementById("img1");
                        ctx.drawImage(img,0,0);

                        //Declare variables
                        var imgData = ctx.getImageData(0,0,c.width,c.height);
                        var data = imgData.data;

                        var red   = [];
                        var green = [];
                        var blue  = [];
                        var alpha = [];


                        //read path
                        loadJSON(function(response){
                            var actual_JSON = JSON.parse(response);
                            console.log(actual_JSON);
                            console.log(actual_JSON.path);
                            var pathArr = actual_JSON.path;
                            var path1D = [];
                            for(var i = 0; i < pathArr.length; i++)
                            {
                                //console.log(pathArr[i].x + " <> " + pathArr[i].y);
                                //path1D.push(pathIdx = (c.width * pathArr[i].y + pathArr[i].x) << 2);  //twoD2oneD row-major
                                path1D.push(pathIdx = (c.width * pathArr[i].x + pathArr[i].y) << 2);    //twoD2oneD column-major
                            }


                            //Read image and make changes on the fly as it's read
                            for(var i = 0; i < data.length; i += 4)
                            {
                                red[i] = imgData.data[i];
                                green[i] = imgData.data[i+1];
                                blue[i] = imgData.data[i+2]; // no change, blue == 0 for black and for yellow
                                alpha[i] = imgData.data[i+3]; // Again, no change

                                for(var j = 0; j < path1D.length; j++)
                                {
                                    if(path1D[j] === i)
                                    {
                                        red[i] = 100;
                                        green[i] = 0;
                                        blue[i] = 100;
                                        //console.log("update!");
                                    }
                                }
                            }

                            // Write the image back to the canvas
                            for (var i = 0; i < data.length; i += 4)
                            {
                                imgData.data[i] = red[i];
                                imgData.data[i+1] = green[i];
                                imgData.data[i+2] = blue[i];
                                imgData.data[i+3] = alpha[i];
                            }


                            ctx.putImageData(imgData, 0, 0);



                        });
                    };

                    function loadJSON(callback) {

                        var xobj = new XMLHttpRequest();
                        xobj.overrideMimeType("application/json");
                        xobj.open('GET', 'path.json', false); // Replace 'my_data' with the path to your file
                        xobj.onreadystatechange = function () {
                            if (xobj.readyState == 4 && xobj.status == "200") {
                                // Required use of an anonymous callback as .open will NOT return a value but simply returns undefined in asynchronous mode
                                callback(xobj.responseText);
                            }
                        };
                        xobj.send(null);
                    }
                </script>
            </div>

            <!-- Javascript files:
                - ajax
                - jquery-ui
                - bootstrap (currently unused)
                - jQuery-validation
                - THREE.js 3D graphics files
                - my source files
            -->
            <script src="js/lib/jquery/jquery.min.js"></script>
            <script src="js/lib/jquery_ui/jquery-ui.min.js"></script>
            <script src="js/lib/three.js/three.js"></script>
            <script src="js/lib/three.js/Detector.js"></script>
            <script src="js/lib/three.js/stats.min.js"></script>
            <script src="js/graphics.js"></script>
            <!-- <script src="js/audio.js"></script> -->
        </div>



    </body>
</html>
